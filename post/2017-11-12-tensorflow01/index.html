<!DOCTYPE html>



























<html class="not-ready text-sm lg:text-base" lang="zh-cn">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>光棍节初探 TensorFlow（一）：数据集的预处理 - BLOG</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="11 月 11 日这天注定对我具有了一定的意义。不是因为它是购物狂欢节或光棍节，而是因为在这一天，我第一次尝试使用 TensorFlow 搭建了一个简单的神经网络。我希望用几篇文章记录这个过程。
最近在读 Fundamentals of Deep Learning 这本书。我选择它的原因是讲解得通俗易懂，又会直白地点出重点内容。然而当我读到第三章「Implementing Neural Networks in TensorFlow」时，整个人就好像懵了一样。对于一个从来没接触过 TensorFlow 的人来说，是难以通过看代码直接理解 Graph, Session 等等这些新概念的。于是联想到程序员的思维修炼里面提到的「SQ3R 阅读法」，赶紧先放下这本书，到网上找其他关于 TensorFlow 的资料，值得推荐的是：
TensorFlow 官方文档中文版 TF Girls「TensorFlow Tutorial」修炼指南（这老师很幽默） youtube 地址 bilibili 地址 没想到我居然也能一天完成了一个基础的神经网络（虽然是从下午 1 点到晚上 2 点）。现在到了「SQ3R 阅读法」中的很重要的 Recite（复述）这步———把这个过程写成文章发布到博客里。
所使用的数据集来自 The Street View House Numbers (SVHN) Dataset，这是一个关于识别街景照片中出现的数字的数据集。
读取数据 首先下载 Format 2 格式的数据，即 .mat 格式的数据。我们先在 iPython 里面探索一下数据：
In[1]: from scipy.io import loadmat as load In[2]: train_data = load(&#39;data/train_32x32.mat&#39;) ...: test_data = load(&#39;data/test_32x32." />
  <meta name="author" content="" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://xzywisdili.com/main.min.css" />

  
  <script
    defer
    src="https://xzywisdili.com/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  <link
    rel="preload"
    as="image"
    href="https://xzywisdili.com/theme.%7B%7B%20if%20site.Params.monoDarkIcon%20%7D%7Dsvg%7B%7B%20else%20%7D%7Dpng%7B%7B%20end%20%7D%7D"
  />

  
  
  
  <link rel="preload" as="image" href="https://pic.stackoverflow.wiki/uploadImages/118/247/190/255/2022/07/28/18/53/8071d74a-1971-4d71-98c5-95575efef90f.svg" />
  
  

  
  <link rel="preload" as="image" href="https://xzywisdili.com/twitter.svg" />
  
  <link rel="preload" as="image" href="https://xzywisdili.com/github.svg" />
  

  
  <link rel="icon" href="https://xzywisdili.com/favicon.ico" />
  <link rel="apple-touch-icon" href="https://xzywisdili.com/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.101.0" />

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="光棍节初探 TensorFlow（一）：数据集的预处理" />
<meta property="og:description" content="11 月 11 日这天注定对我具有了一定的意义。不是因为它是购物狂欢节或光棍节，而是因为在这一天，我第一次尝试使用 TensorFlow 搭建了一个简单的神经网络。我希望用几篇文章记录这个过程。
最近在读 Fundamentals of Deep Learning 这本书。我选择它的原因是讲解得通俗易懂，又会直白地点出重点内容。然而当我读到第三章「Implementing Neural Networks in TensorFlow」时，整个人就好像懵了一样。对于一个从来没接触过 TensorFlow 的人来说，是难以通过看代码直接理解 Graph, Session 等等这些新概念的。于是联想到程序员的思维修炼里面提到的「SQ3R 阅读法」，赶紧先放下这本书，到网上找其他关于 TensorFlow 的资料，值得推荐的是：
TensorFlow 官方文档中文版 TF Girls「TensorFlow Tutorial」修炼指南（这老师很幽默） youtube 地址 bilibili 地址 没想到我居然也能一天完成了一个基础的神经网络（虽然是从下午 1 点到晚上 2 点）。现在到了「SQ3R 阅读法」中的很重要的 Recite（复述）这步———把这个过程写成文章发布到博客里。
所使用的数据集来自 The Street View House Numbers (SVHN) Dataset，这是一个关于识别街景照片中出现的数字的数据集。
读取数据 首先下载 Format 2 格式的数据，即 .mat 格式的数据。我们先在 iPython 里面探索一下数据：
In[1]: from scipy.io import loadmat as load In[2]: train_data = load(&#39;data/train_32x32.mat&#39;) ...: test_data = load(&#39;data/test_32x32." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xzywisdili.com/post/2017-11-12-tensorflow01/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-11-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-11-12T00:00:00+00:00" />


  
  <meta itemprop="name" content="光棍节初探 TensorFlow（一）：数据集的预处理">
<meta itemprop="description" content="11 月 11 日这天注定对我具有了一定的意义。不是因为它是购物狂欢节或光棍节，而是因为在这一天，我第一次尝试使用 TensorFlow 搭建了一个简单的神经网络。我希望用几篇文章记录这个过程。
最近在读 Fundamentals of Deep Learning 这本书。我选择它的原因是讲解得通俗易懂，又会直白地点出重点内容。然而当我读到第三章「Implementing Neural Networks in TensorFlow」时，整个人就好像懵了一样。对于一个从来没接触过 TensorFlow 的人来说，是难以通过看代码直接理解 Graph, Session 等等这些新概念的。于是联想到程序员的思维修炼里面提到的「SQ3R 阅读法」，赶紧先放下这本书，到网上找其他关于 TensorFlow 的资料，值得推荐的是：
TensorFlow 官方文档中文版 TF Girls「TensorFlow Tutorial」修炼指南（这老师很幽默） youtube 地址 bilibili 地址 没想到我居然也能一天完成了一个基础的神经网络（虽然是从下午 1 点到晚上 2 点）。现在到了「SQ3R 阅读法」中的很重要的 Recite（复述）这步———把这个过程写成文章发布到博客里。
所使用的数据集来自 The Street View House Numbers (SVHN) Dataset，这是一个关于识别街景照片中出现的数字的数据集。
读取数据 首先下载 Format 2 格式的数据，即 .mat 格式的数据。我们先在 iPython 里面探索一下数据：
In[1]: from scipy.io import loadmat as load In[2]: train_data = load(&#39;data/train_32x32.mat&#39;) ...: test_data = load(&#39;data/test_32x32."><meta itemprop="datePublished" content="2017-11-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2017-11-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="698">
<meta itemprop="keywords" content="Python,机器学习,TensorFlow," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="光棍节初探 TensorFlow（一）：数据集的预处理"/>
<meta name="twitter:description" content="11 月 11 日这天注定对我具有了一定的意义。不是因为它是购物狂欢节或光棍节，而是因为在这一天，我第一次尝试使用 TensorFlow 搭建了一个简单的神经网络。我希望用几篇文章记录这个过程。
最近在读 Fundamentals of Deep Learning 这本书。我选择它的原因是讲解得通俗易懂，又会直白地点出重点内容。然而当我读到第三章「Implementing Neural Networks in TensorFlow」时，整个人就好像懵了一样。对于一个从来没接触过 TensorFlow 的人来说，是难以通过看代码直接理解 Graph, Session 等等这些新概念的。于是联想到程序员的思维修炼里面提到的「SQ3R 阅读法」，赶紧先放下这本书，到网上找其他关于 TensorFlow 的资料，值得推荐的是：
TensorFlow 官方文档中文版 TF Girls「TensorFlow Tutorial」修炼指南（这老师很幽默） youtube 地址 bilibili 地址 没想到我居然也能一天完成了一个基础的神经网络（虽然是从下午 1 点到晚上 2 点）。现在到了「SQ3R 阅读法」中的很重要的 Recite（复述）这步———把这个过程写成文章发布到博客里。
所使用的数据集来自 The Street View House Numbers (SVHN) Dataset，这是一个关于识别街景照片中出现的数字的数据集。
读取数据 首先下载 Format 2 格式的数据，即 .mat 格式的数据。我们先在 iPython 里面探索一下数据：
In[1]: from scipy.io import loadmat as load In[2]: train_data = load(&#39;data/train_32x32.mat&#39;) ...: test_data = load(&#39;data/test_32x32."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href="https://xzywisdili.com/"
      >BLOG</a
    >
    <a
      class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
    ></a>
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  <script>
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const htmlClass = document.documentElement.classList;
    setTimeout(() => htmlClass.remove('not-ready'), 10);

    const setDark = (newDark) => {
      metaTheme.setAttribute('content', newDark ? '#000' : '#fbfbfb');
      htmlClass[newDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', newDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const darkVal = localStorage.getItem('dark');
    setDark(darkVal ? darkVal === 'true' : darkScheme.matches);

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href=" https://twitter.com/xzywisdili "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href=" https://github.com/github.com/xzywisdili "
        target="_blank"
      ></a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"
    >
      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">光棍节初探 TensorFlow（一）：数据集的预处理</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Nov 12, 2017</time>
      
      
    </div>
    
  </header>

  <section><p>11 月 11 日这天注定对我具有了一定的意义。不是因为它是购物狂欢节或光棍节，而是因为在这一天，我第一次尝试使用 TensorFlow 搭建了一个简单的神经网络。我希望用几篇文章记录这个过程。</p>
<p>最近在读 <a href="https://book.douban.com/subject/26425877/">Fundamentals of Deep Learning</a> 这本书。我选择它的原因是讲解得通俗易懂，又会直白地点出重点内容。然而当我读到第三章「Implementing Neural Networks in TensorFlow」时，整个人就好像懵了一样。对于一个从来没接触过 TensorFlow 的人来说，是难以通过看代码直接理解 Graph, Session 等等这些新概念的。于是联想到<a href="https://book.douban.com/subject/5372651/">程序员的思维修炼</a>里面提到的「SQ3R 阅读法」，赶紧先放下这本书，到网上找其他关于 TensorFlow 的资料，值得推荐的是：</p>
<ul>
<li><a href="http://wiki.jikexueyuan.com/project/tensorflow-zh/">TensorFlow 官方文档中文版</a></li>
<li>TF Girls「TensorFlow Tutorial」修炼指南（这老师很幽默）
<ul>
<li><a href="https://www.youtube.com/watch?v=8X9QUwtRSs0&amp;list=PLwY2GJhAPWRcZxxVFpNhhfivuW0kX15yG">youtube 地址</a></li>
<li><a href="https://www.bilibili.com/video/av11079460/?from=search&amp;seid=13313846105672125761">bilibili 地址</a></li>
</ul>
</li>
</ul>
<p>没想到我居然也能一天完成了一个基础的神经网络（虽然是从下午 1 点到晚上 2 点）。现在到了「SQ3R 阅读法」中的很重要的 Recite（复述）这步———把这个过程写成文章发布到博客里。</p>
<p>所使用的数据集来自 <a href="http://ufldl.stanford.edu/housenumbers/">The Street View House Numbers (SVHN) Dataset</a>，这是一个关于识别街景照片中出现的数字的数据集。</p>
<p><img src="https://xzywisdili.com/tensorflow01/dataset.png" alt="Street View"></p>
<h2 id="读取数据">读取数据</h2>
<p>首先下载 Format 2 格式的数据，即 <code>.mat</code> 格式的数据。我们先在 iPython 里面探索一下数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>In[<span style="color:#ae81ff">1</span>]: <span style="color:#f92672">from</span> scipy.io <span style="color:#f92672">import</span> loadmat <span style="color:#66d9ef">as</span> load
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">2</span>]: train_data <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#39;data/train_32x32.mat&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: test_data <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#39;data/test_32x32.mat&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">3</span>]: train_data<span style="color:#f92672">.</span>keys()
</span></span><span style="display:flex;"><span>Out[<span style="color:#ae81ff">3</span>]: dict_keys([<span style="color:#e6db74">&#39;__header__&#39;</span>, <span style="color:#e6db74">&#39;__version__&#39;</span>, <span style="color:#e6db74">&#39;__globals__&#39;</span>, <span style="color:#e6db74">&#39;X&#39;</span>, <span style="color:#e6db74">&#39;y&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">4</span>]: train_data[<span style="color:#e6db74">&#39;X&#39;</span>]<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>Out[<span style="color:#ae81ff">4</span>]: (<span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">73257</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">5</span>]: train_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>Out[<span style="color:#ae81ff">5</span>]: (<span style="color:#ae81ff">73257</span>, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>我们把训练集和测试集的样本和标签提取出来。我不想让训练数据集的标签是一个二维数组，所以简单调整一下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>In[<span style="color:#ae81ff">6</span>]: train_samples <span style="color:#f92672">=</span> train_data[<span style="color:#e6db74">&#39;X&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: train_labels <span style="color:#f92672">=</span> train_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>reshape(train_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: test_samples <span style="color:#f92672">=</span> test_data[<span style="color:#e6db74">&#39;X&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: test_labels <span style="color:#f92672">=</span> test_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>reshape(test_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">7</span>]: train_labels<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>Out[<span style="color:#ae81ff">7</span>]: (<span style="color:#ae81ff">73257</span>,)
</span></span></code></pre></div><h2 id="转换数据维度">转换数据维度</h2>
<p>这时 <code>train_samples</code> 的维度是 <code>(32, 32, 3, 73257)</code>，即(图片高，图片宽，通道数，图片数)。很奇怪原始格式把图片数放在了第四个维度上。我们希望 <code>train_samples</code> 的维度是(图片数，图片高，图片宽，通道数)，即 <code>(73257, 32, 32, 3)</code> 的模式。而 <code>train_labels</code> 也需要一些变化。现在的 <code>train_labels</code> 中每个 <code>label</code> 都是图像上对应的数字，如 3，我们希望它变成 <code>[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]</code> 的模式。其中麻烦一点的是 <code>.mat</code> 格式的数据中并没有 0，而是用 10 来表示 0，这需要我们做一点小小的调整：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reformat</span>(samples, labels):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 改变原始数据的形状</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (图片高，图片宽，通道数，图片数) -&gt; (图片数，图片高，图片宽，通道数)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># labels 转换为 one-hot encoding [3] -&gt; [0, 0, 0, 1, 0, 0, 0, 0, 0, 0]</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>transpose(samples, (<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    one_hot_labels <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((labels<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, label <span style="color:#f92672">in</span> enumerate(labels):
</span></span><span style="display:flex;"><span>        index <span style="color:#f92672">=</span> label <span style="color:#66d9ef">if</span> label <span style="color:#f92672">!=</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        one_hot_labels[i, index] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples, one_hot_labels
</span></span></code></pre></div><h2 id="压缩数据通道数可视化数据">压缩数据通道数，可视化数据</h2>
<p>然后再把图片的 RGB 三通道压缩成一通道的灰度模式，同时压缩映射到 -1.0~1.0 上：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalize</span>(samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    @ samples: numpy array
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>add<span style="color:#f92672">.</span>reduce(samples, keepdims<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples <span style="color:#f92672">/</span> <span style="color:#ae81ff">128.0</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.0</span>
</span></span></code></pre></div><p>改变成灰度图之后，我们现在想看看最初的图片和灰度图。参数 <code>huidu</code> 是用来表示想要展示的是否是灰度图。如果是，则调用关于灰度图的相关函数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inspect</span>(datasets, labels, i, huidu<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 显示图片查看</span>
</span></span><span style="display:flex;"><span>    print(labels[i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> huidu:
</span></span><span style="display:flex;"><span>        huidu_shape <span style="color:#f92672">=</span> (datasets<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>], datasets<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>imshow(datasets[i]<span style="color:#f92672">.</span>reshape(huidu_shape), cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>imshow(datasets[i])
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p>我们对训练集和测试集进行调整维度和压缩通道的预处理：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>In[<span style="color:#ae81ff">8</span>]: re_train_samples, re_train_labels <span style="color:#f92672">=</span> reformat(train_samples, train_labels)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: re_test_samples, re_test_labels <span style="color:#f92672">=</span> reformat(test_samples, test_labels)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In[<span style="color:#ae81ff">9</span>]: final_train_samples <span style="color:#f92672">=</span> normalize(re_train_samples)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: final_train_labels <span style="color:#f92672">=</span> re_train_labels
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: final_test_samples <span style="color:#f92672">=</span> normalize(re_test_samples)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>: final_test_labels <span style="color:#f92672">=</span> re_test_labels
</span></span></code></pre></div><p>现在我们随便选择训练集中的一个样本，看看它的原始图片和灰度图：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>inspect(re_train_samples, train_labels, <span style="color:#ae81ff">31960</span>)
</span></span></code></pre></div><p><img src="https://xzywisdili.com/tensorflow01/inspect_color.png" alt="inspect color"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>inspect(final_train_samples, train_labels, <span style="color:#ae81ff">31960</span>, huidu<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>下面就是灰度图：
<img src="https://xzywisdili.com/tensorflow01/inspect_huidu.png" alt="inspect huidu">
好了，一切完美运行！最后，我们想看看我们训练集和测试集的标签的分布情况，画出数字 0~9 的分布情况的直方图：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distribution</span>(labels, name):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 查看 labels 的分布，并画出统计图</span>
</span></span><span style="display:flex;"><span>    count <span style="color:#f92672">=</span> Counter(labels)
</span></span><span style="display:flex;"><span>    y_pos <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(count))
</span></span><span style="display:flex;"><span>    y_count <span style="color:#f92672">=</span> [count[i] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> count[<span style="color:#ae81ff">10</span>] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> y_pos]
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar(y_pos, y_count, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xticks(y_pos, y_pos)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Count&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; Label Distribution&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>In[<span style="color:#ae81ff">10</span>]: distribution(train_labels, <span style="color:#e6db74">&#39;Train&#39;</span>)
</span></span></code></pre></div><p><img src="https://xzywisdili.com/tensorflow01/train_label_dist.png" alt="train labels distribution"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>In[<span style="color:#ae81ff">11</span>]: distribution(test_labels, <span style="color:#e6db74">&#39;Train&#39;</span>)
</span></span></code></pre></div><p><img src="https://xzywisdili.com/tensorflow01/test_label_dist.png" alt="test labels distribution"></p>
<p>可以看到 <code>train_labels</code> 和 <code>test_labels</code> 具有相似的分布结构，说明训练集和测试集的划分还算合理，我们可以接下来继续用。</p>
<p>至此，我们的预处理就结束了。我们把这里所有的代码整理为 <code>load.py</code> 以供接下来的神经网络使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.io <span style="color:#f92672">import</span> loadmat <span style="color:#66d9ef">as</span> load
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 tensorflow 实现图像识别</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_data</span>():
</span></span><span style="display:flex;"><span>    train_data <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#39;data/train_32x32.mat&#39;</span>)
</span></span><span style="display:flex;"><span>    test_data <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#39;data/test_32x32.mat&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># extra_data = load(&#39;data/extra_32x32.mat&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> train_data, test_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reformat</span>(samples, labels):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 改变原始数据的形状</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (图片高，图片宽，通道数，图片数) -&gt; (图片数，图片高，图片宽，通道数)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># labels 转换为 one-hot encoding [3] -&gt; [0, 0, 0, 1, 0, 0, 0, 0, 0, 0]</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>transpose(samples, (<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    one_hot_labels <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((labels<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, label <span style="color:#f92672">in</span> enumerate(labels):
</span></span><span style="display:flex;"><span>        index <span style="color:#f92672">=</span> label <span style="color:#66d9ef">if</span> label <span style="color:#f92672">!=</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        one_hot_labels[i, index] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples, one_hot_labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalize</span>(samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    灰度化：(R + G + B) / 3（省内存，加快训练速度）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    将图片从 0 ~ 255 映射到 -1.0 ~ 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    @ samples: numpy array
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>add<span style="color:#f92672">.</span>reduce(samples, keepdims<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples <span style="color:#f92672">/</span> <span style="color:#ae81ff">128.0</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distribution</span>(labels, name):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 查看 labels 的分布，并画出统计图</span>
</span></span><span style="display:flex;"><span>    count <span style="color:#f92672">=</span> Counter(labels)
</span></span><span style="display:flex;"><span>    y_pos <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(count))
</span></span><span style="display:flex;"><span>    y_count <span style="color:#f92672">=</span> [count[i] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> count[<span style="color:#ae81ff">10</span>] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> y_pos]
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar(y_pos, y_count, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xticks(y_pos, y_pos)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Count&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; Label Distribution&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inspect</span>(datasets, labels, i, huidu<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 显示图片查看</span>
</span></span><span style="display:flex;"><span>    print(labels[i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> huidu:
</span></span><span style="display:flex;"><span>        huidu_shape <span style="color:#f92672">=</span> (datasets<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>], datasets<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>imshow(datasets[i]<span style="color:#f92672">.</span>reshape(huidu_shape), cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>imshow(datasets[i])
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_data, test_data <span style="color:#f92672">=</span> load_data()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_samples <span style="color:#f92672">=</span> train_data[<span style="color:#e6db74">&#39;X&#39;</span>]
</span></span><span style="display:flex;"><span>train_labels <span style="color:#f92672">=</span> train_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>reshape(train_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>test_samples <span style="color:#f92672">=</span> test_data[<span style="color:#e6db74">&#39;X&#39;</span>]
</span></span><span style="display:flex;"><span>test_labels <span style="color:#f92672">=</span> test_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>reshape(test_data[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># test_samples = extra_data[&#39;X&#39;]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># test_labels = extra_data[&#39;y&#39;]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Train Data Samples Shape: &#39;</span>, train_samples<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Train Data Labels Shape: &#39;</span>, train_labels<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Data Samples Shape: &#39;</span>, test_samples<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Data Labels Shape: &#39;</span>, test_labels<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(&#39;Extra Data Samples Shape: &#39;, extra_data[&#39;X&#39;].shape)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(&#39;Extra Data Labels Shape: &#39;, extra_data[&#39;y&#39;].shape)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re_train_samples, re_train_labels <span style="color:#f92672">=</span> reformat(train_samples, train_labels)
</span></span><span style="display:flex;"><span>re_test_samples, re_test_labels <span style="color:#f92672">=</span> reformat(test_samples, test_labels)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>final_train_samples <span style="color:#f92672">=</span> normalize(re_train_samples)
</span></span><span style="display:flex;"><span>final_train_labels <span style="color:#f92672">=</span> re_train_labels
</span></span><span style="display:flex;"><span>final_test_samples <span style="color:#f92672">=</span> normalize(re_test_samples)
</span></span><span style="display:flex;"><span>final_test_labels <span style="color:#f92672">=</span> re_test_labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num_labels <span style="color:#f92672">=</span> final_train_labels<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>] <span style="color:#75715e"># 10</span>
</span></span><span style="display:flex;"><span>image_size <span style="color:#f92672">=</span> final_train_samples<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>] <span style="color:#75715e"># 32</span>
</span></span><span style="display:flex;"><span>num_channel <span style="color:#f92672">=</span> final_train_samples<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">3</span>] <span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># See some pictures</span>
</span></span><span style="display:flex;"><span>    inspect(re_train_samples, train_labels, <span style="color:#ae81ff">1</span>, huidu<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># See some gray pictures</span>
</span></span><span style="display:flex;"><span>    inspect(final_train_samples, train_labels, <span style="color:#ae81ff">1</span>, huidu<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># See the distribution of the labels</span>
</span></span><span style="display:flex;"><span>    distribution(train_labels, <span style="color:#e6db74">&#39;Train&#39;</span>)
</span></span><span style="display:flex;"><span>    distribution(test_labels, <span style="color:#e6db74">&#39;Test&#39;</span>)
</span></span></code></pre></div><h2 id="结语">结语</h2>
<p>你可能心里说：「骗子，你根本没写 TensorFlow 的内容」。嘿嘿，先别打我，我们接下来会把神经网络的相关代码写在另一个程序 <code>network.py</code> 里面，在那里就需要 TensorFlow 的内容了。碍于篇幅，不好在一篇文章中写完。关于使用 TensorFlow 构建基础的神经网络，我会在下一篇文章中介绍。</p>
<p>顺带一提，在写日志的时候，把自己写过的代码再过一遍，我觉得是一种很好的学习方法：）为早日精通 TensorFlow 奋斗！</p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://xzywisdili.com/tags/python"
      >Python</a
    >
     
    <a
      class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://xzywisdili.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0"
      >机器学习</a
    >
     
    <a
      class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://xzywisdili.com/tags/tensorflow"
      >TensorFlow</a
    >
    
  </footer>
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a class="flex w-1/2 items-center p-6 pr-3 no-underline" href="https://xzywisdili.com/post/2017-11-21-rbasic/"
      ><span class="mr-1.5">←</span><span>R 语言的那些最最最基础</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline"
      href="https://xzywisdili.com/post/2017-10-23-why-latex/"
      ><span>为什么要使用 LaTeX 呢？</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  
</article>


    </main>

    <footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
  <div class="mr-auto">
    &copy; 2022
    <a class="link" href="https://xzywisdili.com/">BLOG</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Powered by Hugo️️</a
  >️
  <a class="link" href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank"
    >▷ Paper 6</a
  >
</footer>

  </body>
</html>
